## 一、拓竹Cyberbrick介绍及本项目缘由
首先，拓竹是一家消费级3D打印机厂商，其开发的多款3D打印机广受好评，尤其是A1系列价格已经低至千元左右。

同时，拓竹运营的MakerWorld社区是一个大型3D作品分享平台，让小白用户（无任何建模经验）可以通过这个社区下载获取模型，并进行3D打印。

但是，绝大多数3D打印作品只能静态展示，或者手动推拉把玩。想要让3D打印的小车动起来，又需要一定经验的电子电路的技能和知识。介于此，拓竹官方推出了CyberBrick套件，这个套件让小白用户通过简单的积木拼搭的方式，就可以创作一个能够遥控行走的3D打印小车，提供了更多的乐趣。

>CyberBrick官方介绍：CyberBrick 是一款模块化智能玩具生态系统，融合了可编程硬件、3D 打印结构和双层编码环境。它通过乐高般的简洁性，将 3D 打印与电子和编程相结合。CyberBrick 使任何人都能构建和享受各种 3D 打印项目，从遥控玩具到生产力工具。

然而，CyberBrick套件的价格确并不便宜，一套新手入门套件要199元，且一套只能应用一个玩具小车。所以就有了我做的这个项目，利用便宜的散件复现「拓竹Cyberbrick」，不仅可以降低成本，还可以提供更多的玩法可能性。

我把这个项目称为「OpenCyberbrick」，让我们开始吧。

## 二、拆解和复现思路
#### Cyberbrick的核心逻辑
在CyberBrick众筹阶段，我就通过介绍和观看演示视频，大概了解了其构成和运行逻辑。CyberBrick套件发布的第一天，我就入手了新手套装，并且打印了官方卡车模型进行了试用。

CyberBrick虽分为遥控部分和被控部分，但两部分使用的主控板均为esp32 c3 mini，且可以互换。只是遥控部分，通过「遥控接收底板」收集摇杆、按钮、开关等输入设备的信息，发送给被控部分。而被控部分，将收到的信号，通过「遥控接收底板」传递给电机、舵机LED灯等输出设备。而遥控部分和接收部分，似乎使用的是eps独有的espnow协议。
#### 复现思路
了解了Cyberbrick的核心逻辑，也就理清了复现思路。
- 1、主控板传输协议：主控板我们也采用乐鑫esp系列芯片，其esp8266、esp32、esp32 c3等芯片价格便宜，还包含wifi模块。模块之间，可以通过espnow进行通信，也解决了通信传输协议的问题。
- 2、被控部分：采用esp8266连接一个L208N电机驱动模块（电机驱动模块连接电机提供动力）、9g舵机模块（用于转向）、WS2812的Led灯组（用于行车灯、转向灯、灯光秀等）。
- 3、遥控部分：采用esp32 c3连接两个ps2摇杆模块（自带两个按钮），和另外两个按钮模块，这样就组成了12通道的遥控器，可支持的动作非常多。
- 4、在后续的优化过程中，我发现其实使用手机来作为遥控端更合适，支持的动作更多，还进一步的省去了遥控端的硬件、软件成本。所以后续介绍中，涉及复现遥控部分，只会简单介绍。
## 三、成品展示
[video]
## 四、被控部分详解
#### 1、3D打印的Jeep小车本体
首先，需要和Cyberbrick一样用3D打印机打印出Jeep小车的零件并组装。这里需要注意的是：因为我们散件集成度不高，占用的空间要比原装Cyberbrick零件大很多，所以要选择大一些的模型，太小的模型没有空间放置我们的电子零件。

这里我选择的是[威利的CyberBrick遥控吉普车](https://makerworld.com.cn/zh/models/1217847-wei-li-de-cyberbrickyao-kong-ji-pu-che#profileId-1295819)，这款Jeep前备箱里有足够的空间容纳电子设备，并且是一个比较典型的架构：使用电机来提供动力前进后退，使用舵机来进行转向，并且有Led灯的预留空间。
![image.png](https://pubdz.paperol.cn/ryjimage/20251107135414397.png)

#### 2、Jeep小车的电子电路
![image.png](https://pubdz.paperol.cn/ryjimage/20251107141745822.png)

以上，是这个Jeep小车的电子电路接线示意图，这里我踩过的坑有：
- 不同设备模块有不同的额定电压，比如esp8266需要稳定的3.7V电压、舵机和Led需要的是5V、电机驱动模块则是一个区间（电压越高动力越好），如果想要用一块电池来给整个系统供电，就要在不同设备前增加降压稳压模块。
- 7.4V电压的电池价格比较贵，且需要配套充电设备。但是3.7V的18650和14500电池在很多废旧玩具、废旧电子产品里都有，我制作了一条串联线，可以将两个3.7V电池串联为一个7.4V来使用，但是要注意使用内阻一致的电池串联。
-  esp8266的GPIO接口连接电机驱动、舵机、Led的信号接口，并通过PWM信号发出控制命令，但是也需要和这些设备共地。
#### 3、软件程序
esp设备支持使用Micropython和Arduino语言进行开发，我正好有一些Python基础，所以默认就使用Micropython进行了开发。

软件部分项目代码已经放在Github上，地址：[OpenCyberbrick的Github地址](https://github.com/Ya-chunJen/OpenCyberbrick) 或  [OpenCyberbrick的Gitee地址](https://gitee.com/renyajun1990/OpenCyberbrick) 。这里介绍一下，每个项目文件的作用：

- jeep_motor.py，电机的驱动程序，控制电机的转向和转速，实现小车的前进和后退。
- jeep_servo.py，舵机的驱动程序，控制舵机的旋转角度，实现小车的转向。
- jeep_led.py，Led灯的驱动程序，控制两个WS218的点亮，实现小车的行车灯、倒车灯、转向灯和灯光秀灯效果。
- wifi.py，用来让主控设备联网，实现局域网控制。
- wificonfig.json，用来存储要连接的网络的信息，可在遥控端网页修改。
- jeep_action.py，Jeep小车的动作汇总控制，将收到的遥控信号，翻译为电机、舵机、LED的动作命令并调用执行，电机、舵机、Led的控制GPIO引脚号也放在这里配置。
- jeep_espnow_rec.py，esp now信号监听程序，会持续监听esp now收到的信息，并传递给jeep_action执行。
- jeep_websocket_rec.py，发起一个websocket的服务端，可通过局域网接收网页客户端发出的信号，传递给jeep_action执行。
- main.py，程序主入口，可控制使用何种遥控信号接收方式。
- jeep_remote_index.html，遥控端H5页面，支持通过按钮、设备陀螺仪体感来控制。此文件不需要上传到esp主控，需要保存到用来遥控的手机上。
## 五、遥控部分详解
不同于Cyberbrick，本项目在复现时虽然也实现了单独的遥控设备控制，但是最终还是推荐使用手机进行遥控。在使用手机遥控时，还分为按钮控制和体感控制。
#### 1、espnow遥控
espnow遥控其实可以作为一个独立的项目，它不仅可以用作Cyberbrick的遥控，还可以遥控其他esp设备。它也包含了硬件部分和软件部分：
![image.png](https://pubdz.paperol.cn/ryjimage/20251108235550629.png)

- 硬件部分，由一个esp32连接两个PS2摇杆和两个普通按钮，以及电源、开关组成。
- 软件部分，同样由Micropython开发，获取PS2摇杆及按钮的数据，格式化后转发给被控设备。
- 这个遥控，还可以通过按钮切换被控设置，实现一个遥控控制多个设备。

这个遥控的项目，随后可能会有单独的文章介绍。

#### 2、手机网页按钮遥控
一个遥控设备和一个被控设备，成本还是很高。能不能利用大家都有的手机作为遥控端呢?答案当然是可以的。esp设备有wifi功能，可以连接路由器加入家里的局域网，也可以发射一个热点网络，自己组建一个局域网。

在被控设备的esp主控上，运行一个服务端，可以接受局域网设备发送的命令请求，再将这些命令请求转为Jeep小车的动作。

在遥控测，使用手机打开一个HTML页面，将页面上的按钮点击释放等动作发送到服务端，就可以进行远程操作。这里有几个点比较特殊：
- 由于esp设备内存非常少，无法让服务端返回html内容，所以控制页面的HTML文件，需要提前保存到遥控手机上。iPhone可以使用「HTML Viewer」打开浏览本地的HTML文件。安卓设备可点击HTML文件，使用浏览器打开浏览。
- 由于遥控器对实时性的要求很高，普通的HTTP的get或post请求对服务端的压力很大，所以这里使用了websocket类型的长连接。满足实时性的同时，对服务端的压力也降低了很多。
#### 3、手机体感遥控

![image.png](https://pubdz.paperol.cn/ryjimage/20251025225726754.png)
按钮控制虽然简单明了，但是在「酷」方面还不太够，而体感控制就很「酷」。在HTML页面上，获取手机陀螺仪的数据，将手机姿态的变化，转化为Jeep小车的动作。比如：
- X轴：小于-20度时为向前轴，大于20度时为向后退，介于-20到20之间时为静止。
- Y轴：小于-20度时为左转，大于20度时为右转，介于-20到20之间时为静止。
- Z轴：未用到。
X轴和Y轴，可以同时检测实现左前方、右前方、左后方、右后方这些组合动作。
## 七、更多功能可能性
以上大部分功能，都是对标Cyberbrick实现的，在遥控端有不一样的地方。但是其实，我们可以有更多的可能性，比如给esp now遥控加一个屏幕、给Jeep小车加一个屏幕、给Jeep小车增加一些音效、增加避障雷达等等。这个就是OpenCyberbrick可以提供的更多可能性和趣味性。
## 八、总结
本篇文章，只是介绍了这个项目的大体逻辑，硬件和软件方面都还有很多细节，这里限于篇幅的问题，就不再一一讲解了。如果你对这个项目感兴趣，欢迎给我留言，一起交流。

如果你会嘉立创打板，并对我的这些项目感兴趣，愿意和我一起折腾也「非常」欢迎和我联系，一起创作一些有意思的项目。